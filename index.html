<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeContent Client Retention Dashboard - Renewal Pipeline</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f9fafb;
            color: #111827;
            line-height: 1.6;
        }
        
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1000;
        }
        
        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }
        
        .sync-dot.offline {
            background: #ef4444;
            animation: none;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #6b7280;
            font-size: 1.1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 24px;
        }
        
        .stat-icon.blue { background-color: #dbeafe; color: #2563eb; }
        .stat-icon.green { background-color: #dcfce7; color: #16a34a; }
        .stat-icon.yellow { background-color: #fef3c7; color: #d97706; }
        .stat-icon.red { background-color: #fee2e2; color: #dc2626; }
        .stat-icon.purple { background-color: #ede9fe; color: #7c3aed; }
        
        .stat-info h3 {
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .stat-info p {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .btn {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .btn:hover {
            background-color: #1d4ed8;
        }
        
        .btn-success {
            background-color: #16a34a;
        }
        
        .btn-success:hover {
            background-color: #15803d;
        }
        
        .btn-secondary {
            background-color: #6b7280;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        
        .btn-warning {
            background-color: #f59e0b;
        }
        
        .btn-warning:hover {
            background-color: #d97706;
        }
        
        .form-section {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .table-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 40px;
        }
        
        .table-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .client-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .client-filter select {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background-color: #f9fafb;
            padding: 12px;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 500;
            color: #6b7280;
            text-transform: uppercase;
            border-bottom: 1px solid #e5e7eb;
        }
        
        td {
            padding: 16px 12px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }
        
        tr:hover {
            background-color: #f9fafb;
        }
        
        tr.offboarded {
            background-color: #fef2f2;
            opacity: 0.8;
        }
        
        tr.offboarded:hover {
            background-color: #fee2e2;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-badge.healthy {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-badge.at-risk {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-badge.critical {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .status-badge.offboarded {
            background-color: #f3f4f6;
            color: #4b5563;
        }

        .renewal-badge {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .renewal-badge.confirmed {
            background-color: #dcfce7;
            color: #166534;
            border: 2px solid #16a34a;
        }

        .renewal-badge.discussion {
            background-color: #dbeafe;
            color: #1e40af;
            border: 2px solid #3b82f6;
        }

        .renewal-badge.at-risk {
            background-color: #fef3c7;
            color: #92400e;
            border: 2px solid #f59e0b;
        }

        .renewal-badge.churned {
            background-color: #fee2e2;
            color: #991b1b;
            border: 2px solid #dc2626;
        }

        .renewal-badge.pending {
            background-color: #f3f4f6;
            color: #4b5563;
            border: 2px solid #9ca3af;
        }
        
        .month-indicator {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .offboard-date {
            font-size: 0.75rem;
            color: #dc2626;
            font-weight: 500;
            margin-top: 4px;
        }
        
        .details {
            font-size: 0.75rem;
            color: #6b7280;
            line-height: 1.4;
        }
        
        .account-manager {
            font-size: 0.875rem;
            color: #2563eb;
            font-weight: 500;
        }
        
        .notes {
            font-size: 0.75rem;
            color: #6b7280;
            line-height: 1.4;
            max-width: 200px;
            word-wrap: break-word;
        }
        
        .notes:empty::before {
            content: "No notes";
            color: #9ca3af;
            font-style: italic;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
            margin: 0 2px;
        }
        
        .edit-btn {
            color: #2563eb;
        }
        
        .edit-btn:hover {
            background-color: #dbeafe;
        }
        
        .delete-btn {
            color: #dc2626;
        }
        
        .delete-btn:hover {
            background-color: #fee2e2;
        }
        
        .offboard-btn {
            color: #f59e0b;
        }
        
        .offboard-btn:hover {
            background-color: #fef3c7;
        }
        
        .reactivate-btn {
            color: #16a34a;
        }
        
        .reactivate-btn:hover {
            background-color: #dcfce7;
        }
        
        .action-buttons {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .hidden {
            display: none;
        }

        .join-date {
            font-size: 0.75rem;
            color: #059669;
            font-weight: 500;
            margin-top: 4px;
        }

        .days-counter {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin-bottom: 16px;
            color: #111827;
        }

        .modal p {
            margin-bottom: 20px;
            color: #6b7280;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* RENEWAL PIPELINE SPECIFIC STYLES */
        .renewal-pipeline-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
            overflow: hidden;
        }

        .pipeline-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pipeline-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pipeline-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: #e5e7eb;
        }

        .pipeline-stat {
            background: white;
            padding: 20px;
            text-align: center;
        }

        .pipeline-stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .pipeline-stat-value.confirmed { color: #16a34a; }
        .pipeline-stat-value.discussion { color: #3b82f6; }
        .pipeline-stat-value.risk { color: #f59e0b; }
        .pipeline-stat-value.churned { color: #dc2626; }

        .pipeline-stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 500;
        }

        .pipeline-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            background: #f9fafb;
        }

        .pipeline-tab {
            flex: 1;
            padding: 16px 24px;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .pipeline-tab:hover {
            background: #f3f4f6;
        }

        .pipeline-tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .pipeline-tab.critical {
            border-bottom-color: #dc2626;
            color: #dc2626;
        }

        .pipeline-tab.urgent {
            border-bottom-color: #f59e0b;
            color: #f59e0b;
        }

        .pipeline-content {
            padding: 20px;
        }

        .renewal-card {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .renewal-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .renewal-card.critical-renewal {
            border-left: 4px solid #dc2626;
            background: #fef2f2;
        }

        .renewal-card.urgent-renewal {
            border-left: 4px solid #f59e0b;
            background: #fffbeb;
        }

        .renewal-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .renewal-card-title {
            flex: 1;
        }

        .renewal-card-title h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }

        .renewal-card-title .contract-info {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .renewal-card-actions {
            display: flex;
            gap: 8px;
        }

        .renewal-card-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .renewal-info-item {
            display: flex;
            flex-direction: column;
        }

        .renewal-info-label {
            font-size: 0.75rem;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .renewal-info-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: #111827;
        }

        .days-until {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .days-until.critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .days-until.urgent {
            background: #fef3c7;
            color: #92400e;
        }

        .days-until.normal {
            background: #dbeafe;
            color: #1e40af;
        }

        .renewal-notes {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 12px;
        }

        .renewal-notes:empty::before {
            content: "No renewal notes";
            font-style: italic;
            color: #9ca3af;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #111827;
        }

        .empty-state-description {
            font-size: 0.875rem;
        }

        .quick-action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-action-btn.confirmed {
            background: #dcfce7;
            color: #166534;
        }

        .quick-action-btn.confirmed:hover {
            background: #16a34a;
            color: white;
        }

        .quick-action-btn.discussion {
            background: #dbeafe;
            color: #1e40af;
        }

        .quick-action-btn.discussion:hover {
            background: #3b82f6;
            color: white;
        }

        .quick-action-btn.at-risk {
            background: #fef3c7;
            color: #92400e;
        }

        .quick-action-btn.at-risk:hover {
            background: #f59e0b;
            color: white;
        }

        .quick-action-btn.churned {
            background: #fee2e2;
            color: #991b1b;
        }

        .quick-action-btn.churned:hover {
            background: #dc2626;
            color: white;
        }

        .timeline-item {
            display: flex;
            gap: 12px;
            padding: 8px 0;
            border-left: 2px solid #e5e7eb;
            padding-left: 16px;
            margin-left: 8px;
        }

        .timeline-date {
            font-size: 0.75rem;
            color: #6b7280;
            min-width: 80px;
        }

        .timeline-event {
            font-size: 0.875rem;
            color: #111827;
        }
    </style>
</head>
<body>
    <div class="sync-indicator">
        <div class="sync-dot" id="sync-dot"></div>
        <span id="sync-status">Connected</span>
    </div>

    <!-- Offboard Modal -->
    <div id="offboard-modal" class="modal">
        <div class="modal-content">
            <h3>Offboard Client</h3>
            <p>Are you sure you want to offboard <strong id="offboard-client-name"></strong>?</p>
            <div class="form-group" style="margin-bottom: 20px;">
                <label>Offboard Date:</label>
                <input type="date" id="offboard-date" style="width: 100%;">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeOffboardModal()">Cancel</button>
                <button class="btn btn-warning" onclick="confirmOffboard()">Offboard Client</button>
            </div>
        </div>
    </div>

    <!-- Renewal Status Modal -->
    <div id="renewal-modal" class="modal">
        <div class="modal-content">
            <h3>Update Renewal Status</h3>
            <p>Update renewal information for <strong id="renewal-client-name"></strong></p>
            
            <div class="form-group" style="margin-bottom: 16px;">
                <label>Contract End Date *</label>
                <input type="date" id="renewal-contract-end" style="width: 100%;">
            </div>

            <div class="form-group" style="margin-bottom: 16px;">
                <label>Renewal Status *</label>
                <select id="renewal-status" style="width: 100%;">
                    <option value="pending">Pending Review</option>
                    <option value="confirmed">‚úÖ Confirmed Renewal</option>
                    <option value="discussion">üí¨ In Discussion</option>
                    <option value="at-risk">‚ö†Ô∏è At Risk</option>
                    <option value="churned">‚ùå Churned</option>
                </select>
            </div>

            <div class="form-group" style="margin-bottom: 16px;">
                <label>Contract Value (Optional)</label>
                <input type="number" id="renewal-contract-value" placeholder="e.g., 5000" style="width: 100%;">
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label>Renewal Notes</label>
                <textarea id="renewal-notes" rows="4" placeholder="Add notes about renewal discussions, concerns, or next steps..." style="width: 100%;"></textarea>
            </div>

            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeRenewalModal()">Cancel</button>
                <button class="btn btn-success" onclick="saveRenewalStatus()">Save Renewal Info</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>BeContent Client Retention Dashboard</h1>
            <p>Monitor client health scores and renewal pipeline</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">üë•</div>
                <div class="stat-info">
                    <h3>Total Clients</h3>
                    <p id="total-clients">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">‚úì</div>
                <div class="stat-info">
                    <h3>Active & Healthy</h3>
                    <p id="healthy-clients" style="color: #16a34a;">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon yellow">‚ö†</div>
                <div class="stat-info">
                    <h3>At Risk</h3>
                    <p id="at-risk-clients" style="color: #d97706;">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon red">üìâ</div>
                <div class="stat-info">
                    <h3>Critical</h3>
                    <p id="critical-clients" style="color: #dc2626;">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">üèÉ‚Äç‚ôÇÔ∏è</div>
                <div class="stat-info">
                    <h3>Offboarded</h3>
                    <p id="offboarded-clients" style="color: #7c3aed;">0</p>
                </div>
            </div>
        </div>

        <!-- RENEWAL PIPELINE SECTION -->
        <div class="renewal-pipeline-section">
            <div class="pipeline-header">
                <h2>
                    <span>üîÑ</span>
                    <span>Renewal Pipeline</span>
                </h2>
                <button class="btn" onclick="refreshRenewalPipeline()">‚Üª Refresh</button>
            </div>

            <div class="pipeline-stats">
                <div class="pipeline-stat">
                    <div class="pipeline-stat-value confirmed" id="renewal-confirmed-count">0</div>
                    <div class="pipeline-stat-label">Confirmed</div>
                </div>
                <div class="pipeline-stat">
                    <div class="pipeline-stat-value discussion" id="renewal-discussion-count">0</div>
                    <div class="pipeline-stat-label">In Discussion</div>
                </div>
                <div class="pipeline-stat">
                    <div class="pipeline-stat-value risk" id="renewal-risk-count">0</div>
                    <div class="pipeline-stat-label">At Risk</div>
                </div>
                <div class="pipeline-stat">
                    <div class="pipeline-stat-value churned" id="renewal-churned-count">0</div>
                    <div class="pipeline-stat-label">Churned</div>
                </div>
            </div>

            <div class="pipeline-tabs">
                <div class="pipeline-tab active critical" data-tab="15-days" onclick="switchRenewalTab('15-days')">
                    üî¥ Next 15 Days (<span id="count-15-days">0</span>)
                </div>
                <div class="pipeline-tab urgent" data-tab="30-days" onclick="switchRenewalTab('30-days')">
                    üü† Next 30 Days (<span id="count-30-days">0</span>)
                </div>
                <div class="pipeline-tab" data-tab="60-days" onclick="switchRenewalTab('60-days')">
                    üü° Next 60 Days (<span id="count-60-days">0</span>)
                </div>
                <div class="pipeline-tab" data-tab="all" onclick="switchRenewalTab('all')">
                    üìã All Renewals (<span id="count-all">0</span>)
                </div>
            </div>

            <div class="pipeline-content">
                <div id="renewal-15-days" class="renewal-tab-content">
                    <!-- Cards will be dynamically inserted here -->
                </div>
                <div id="renewal-30-days" class="renewal-tab-content hidden">
                    <!-- Cards will be dynamically inserted here -->
                </div>
                <div id="renewal-60-days" class="renewal-tab-content hidden">
                    <!-- Cards will be dynamically inserted here -->
                </div>
                <div id="renewal-all" class="renewal-tab-content hidden">
                    <!-- Cards will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <button class="btn" onclick="toggleForm()">
            ‚ûï Add Client
        </button>

        <div class="form-section hidden" id="client-form">
            <h3 style="margin-bottom: 16px;" id="form-title">Add New Client</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Client Name *</label>
                    <input type="text" id="name" placeholder="Enter client name">
                </div>
                <div class="form-group">
                    <label>Join Date *</label>
                    <input type="date" id="join-date">
                </div>
                <div class="form-group">
                    <label>Contract End Date</label>
                    <input type="date" id="contract-end-date">
                </div>
                <div class="form-group">
                    <label>Account Manager</label>
                    <input type="text" id="account-manager" placeholder="Enter account manager name">
                </div>
                <div class="form-group">
                    <label>NPS Score (0-10) - 30% weight</label>
                    <input type="number" id="nps" min="0" max="10" step="0.1" value="7">
                </div>
                <div class="form-group">
                    <label>Show Up Rate (%) - 10% weight</label>
                    <input type="number" id="showup" min="0" max="100" value="85">
                </div>
                <div class="form-group">
                    <label>Participation Level (0-10) - 10% weight</label>
                    <input type="number" id="participation" min="0" max="10" step="0.1" value="7">
                </div>
                <div class="form-group">
                    <label>Payment Status - 10% weight</label>
                    <select id="payment-status">
                        <option value="true">On Time</option>
                        <option value="false">Late</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Video Went Viral? - 20% weight</label>
                    <select id="video-viral">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Early Signs Feedback - 20% weight</label>
                    <select id="early-signs">
                        <option value="true">Positive</option>
                        <option value="false">Negative</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Renewal Status</label>
                    <select id="form-renewal-status">
                        <option value="pending">Pending Review</option>
                        <option value="confirmed">Confirmed Renewal</option>
                        <option value="discussion">In Discussion</option>
                        <option value="at-risk">At Risk</option>
                        <option value="churned">Churned</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Contract Value</label>
                    <input type="number" id="contract-value" placeholder="e.g., 5000">
                </div>
                <div class="form-group full-width">
                    <label>Notes</label>
                    <textarea id="notes" placeholder="Enter any notes about this client"></textarea>
                </div>
                <div class="form-group full-width">
                    <label>Renewal Notes</label>
                    <textarea id="form-renewal-notes" placeholder="Notes about renewal discussions"></textarea>
                </div>
            </div>
            <div>
                <button class="btn btn-success" id="submit-btn" onclick="addClient()">Add Client</button>
                <button class="btn btn-secondary" onclick="cancelForm()">Cancel</button>
            </div>
        </div>

        <div class="table-section">
            <div class="table-header">
                <h2>Client Health Scores</h2>
                <div class="client-filter">
                    <label>Filter:</label>
                    <select id="client-status-filter" onchange="updateTable()">
                        <option value="all">All Clients</option>
                        <option value="active">Active Only</option>
                        <option value="offboarded">Offboarded Only</option>
                    </select>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Account Manager</th>
                            <th>Contract End</th>
                            <th>Renewal Status</th>
                            <th>Health Score</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="client-table">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDNMzO17wu4NOaR2TjT419f0IzB-pWzU5M",
            authDomain: "becontent-33415.firebaseapp.com",
            databaseURL: "https://becontent-33415-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "becontent-33415",
            storageBucket: "becontent-33415.firebasestorage.app",
            messagingSenderId: "967557303388",
            appId: "1:967557303388:web:b263a25fea91824710ea99",
            measurementId: "G-Z23YF3S7VQ"
        };

        let database;
        let clientsRef;
        
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            clientsRef = database.ref('clients');
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }

        let clients = [];
        let currentEditingClientId = null;
        let currentOffboardingClientId = null;
        let currentRenewalClientId = null;
        let currentRenewalTab = '15-days';

        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('join-date').value = today;
            document.getElementById('offboard-date').value = today;
        });

        function calculateHealthScore(client) {
            const npsScore = (client.nps / 10) * 30;
            const showUpScore = (client.sessionShowUp / 100) * 10;
            const participationScore = (client.participationLevel / 10) * 10;
            const paymentScore = client.paymentOnTime ? 10 : 0;
            const viralScore = client.videoWentViral ? 20 : 0;
            const earlySignsScore = client.earlySigns ? 20 : 0;
            const totalScore = npsScore + showUpScore + participationScore + paymentScore + viralScore + earlySignsScore;
            return totalScore / 10;
        }

        function getHealthCategory(score, isOffboarded = false) {
            if (isOffboarded) return { color: 'offboarded', label: 'Offboarded' };
            if (score >= 8) return { color: 'healthy', label: 'Healthy' };
            if (score >= 7) return { color: 'at-risk', label: 'At Risk' };
            return { color: 'critical', label: 'Critical' };
        }

        function calculateDaysUntilRenewal(contractEndDate) {
            if (!contractEndDate) return null;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const endDate = new Date(contractEndDate);
            endDate.setHours(0, 0, 0, 0);
            
            const diffTime = endDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays;
        }

        function getRenewalUrgency(daysUntil) {
            if (daysUntil === null || daysUntil < 0) return 'expired';
            if (daysUntil <= 15) return 'critical';
            if (daysUntil <= 30) return 'urgent';
            if (daysUntil <= 60) return 'normal';
            return 'future';
        }

        function openRenewalModal(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            currentRenewalClientId = clientId;
            document.getElementById('renewal-client-name').textContent = client.name;
            document.getElementById('renewal-contract-end').value = client.contractEndDate || '';
            document.getElementById('renewal-status').value = client.renewalStatus || 'pending';
            document.getElementById('renewal-contract-value').value = client.contractValue || '';
            document.getElementById('renewal-notes').value = client.renewalNotes || '';
            
            document.getElementById('renewal-modal').style.display = 'block';
        }

        function closeRenewalModal() {
            document.getElementById('renewal-modal').style.display = 'none';
            currentRenewalClientId = null;
        }

        function saveRenewalStatus() {
            if (!currentRenewalClientId) return;

            const contractEndDate = document.getElementById('renewal-contract-end').value;
            const renewalStatus = document.getElementById('renewal-status').value;
            const contractValue = document.getElementById('renewal-contract-value').value;
            const renewalNotes = document.getElementById('renewal-notes').value.trim();

            if (!contractEndDate) {
                alert('Please select a contract end date');
                return;
            }

            const client = clients.find(c => c.id === currentRenewalClientId);
            if (!client) return;

            const updatedClient = {
                ...client,
                contractEndDate: contractEndDate,
                renewalStatus: renewalStatus,
                contractValue: contractValue ? parseFloat(contractValue) : null,
                renewalNotes: renewalNotes,
                updatedAt: new Date().toISOString()
            };

            if (!updatedClient.renewalTimeline) {
                updatedClient.renewalTimeline = [];
            }
            
            updatedClient.renewalTimeline.push({
                date: new Date().toISOString().split('T')[0],
                event: `Renewal status updated to: ${renewalStatus}`,
                notes: renewalNotes
            });

            clientsRef.child(currentRenewalClientId).set(updatedClient);

            closeRenewalModal();
            alert('Renewal information updated successfully!');
        }

        function quickUpdateRenewalStatus(clientId, newStatus) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            const updatedClient = {
                ...client,
                renewalStatus: newStatus,
                updatedAt: new Date().toISOString()
            };

            if (!updatedClient.renewalTimeline) {
                updatedClient.renewalTimeline = [];
            }
            
            updatedClient.renewalTimeline.push({
                date: new Date().toISOString().split('T')[0],
                event: `Quick status update: ${newStatus}`
            });

            clientsRef.child(clientId).set(updatedClient);
        }

        function switchRenewalTab(tabName) {
            currentRenewalTab = tabName;
            
            // Update tab styles
            document.querySelectorAll('.pipeline-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Show/hide content
            document.querySelectorAll('.renewal-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`renewal-${tabName}`).classList.remove('hidden');
        }

        function updateRenewalPipeline() {
            const activeClients = clients.filter(c => !c.isOffboarded && c.contractEndDate);
            
            // Calculate stats
            let confirmedCount = 0;
            let discussionCount = 0;
            let riskCount = 0;
            let churnedCount = 0;
            
            let count15Days = 0;
            let count30Days = 0;
            let count60Days = 0;
            let countAll = activeClients.length;

            activeClients.forEach(client => {
                const status = client.renewalStatus || 'pending';
                if (status === 'confirmed') confirmedCount++;
                else if (status === 'discussion') discussionCount++;
                else if (status === 'at-risk') riskCount++;
                else if (status === 'churned') churnedCount++;

                const daysUntil = calculateDaysUntilRenewal(client.contractEndDate);
                if (daysUntil !== null && daysUntil >= 0) {
                    if (daysUntil <= 15) count15Days++;
                    if (daysUntil <= 30) count30Days++;
                    if (daysUntil <= 60) count60Days++;
                }
            });

            // Update stat counts
            document.getElementById('renewal-confirmed-count').textContent = confirmedCount;
            document.getElementById('renewal-discussion-count').textContent = discussionCount;
            document.getElementById('renewal-risk-count').textContent = riskCount;
            document.getElementById('renewal-churned-count').textContent = churnedCount;

            document.getElementById('count-15-days').textContent = count15Days;
            document.getElementById('count-30-days').textContent = count30Days;
            document.getElementById('count-60-days').textContent = count60Days;
            document.getElementById('count-all').textContent = countAll;

            // Update each tab content
            updateRenewalTabContent('15-days', 15);
            updateRenewalTabContent('30-days', 30);
            updateRenewalTabContent('60-days', 60);
            updateRenewalTabContent('all', null);
        }

        function updateRenewalTabContent(tabName, daysThreshold) {
            const container = document.getElementById(`renewal-${tabName}`);
            container.innerHTML = '';

            let filteredClients = clients.filter(c => !c.isOffboarded && c.contractEndDate);
            
            if (daysThreshold !== null) {
                filteredClients = filteredClients.filter(c => {
                    const daysUntil = calculateDaysUntilRenewal(c.contractEndDate);
                    return daysUntil !== null && daysUntil >= 0 && daysUntil <= daysThreshold;
                });
            }

            // Sort by days until renewal (closest first)
            filteredClients.sort((a, b) => {
                const daysA = calculateDaysUntilRenewal(a.contractEndDate);
                const daysB = calculateDaysUntilRenewal(b.contractEndDate);
                return daysA - daysB;
            });

            if (filteredClients.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <div class="empty-state-icon">üìã</div>
                    <div class="empty-state-title">No renewals in this timeframe</div>
                    <div class="empty-state-description">All contracts are either confirmed or outside this window</div>
                `;
                container.appendChild(emptyState);
                return;
            }

            filteredClients.forEach(client => {
                const daysUntil = calculateDaysUntilRenewal(client.contractEndDate);
                const urgency = getRenewalUrgency(daysUntil);
                const healthScore = calculateHealthScore(client);
                const healthCategory = getHealthCategory(healthScore);
                const renewalStatus = client.renewalStatus || 'pending';

                const card = document.createElement('div');
                card.className = `renewal-card ${urgency === 'critical' ? 'critical-renewal' : urgency === 'urgent' ? 'urgent-renewal' : ''}`;
                
                const contractEndFormatted = new Date(client.contractEndDate).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });

                const joinDateFormatted = client.joinDate ? new Date(client.joinDate).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                }) : 'N/A';

                let daysUntilBadge = '';
                if (daysUntil < 0) {
                    daysUntilBadge = '<span class="days-until critical">EXPIRED</span>';
                } else if (daysUntil === 0) {
                    daysUntilBadge = '<span class="days-until critical">EXPIRES TODAY</span>';
                } else if (daysUntil === 1) {
                    daysUntilBadge = '<span class="days-until critical">1 DAY</span>';
                } else if (daysUntil <= 15) {
                    daysUntilBadge = `<span class="days-until critical">${daysUntil} DAYS</span>`;
                } else if (daysUntil <= 30) {
                    daysUntilBadge = `<span class="days-until urgent">${daysUntil} DAYS</span>`;
                } else {
                    daysUntilBadge = `<span class="days-until normal">${daysUntil} DAYS</span>`;
                }

                const renewalStatusBadge = getRenewalStatusBadge(renewalStatus);

                card.innerHTML = `
                    <div class="renewal-card-header">
                        <div class="renewal-card-title">
                            <h3>${client.name}</h3>
                            <div class="contract-info">
                                ${daysUntilBadge}
                                ${renewalStatusBadge}
                            </div>
                        </div>
                        <div class="renewal-card-actions">
                            <button class="action-btn edit-btn" onclick="openRenewalModal('${client.id}')" title="Update Renewal">üìù</button>
                            <button class="action-btn edit-btn" onclick="editClient('${client.id}')" title="Edit Client">‚úèÔ∏è</button>
                        </div>
                    </div>

                    <div class="renewal-card-body">
                        <div class="renewal-info-item">
                            <div class="renewal-info-label">Contract End Date</div>
                            <div class="renewal-info-value">${contractEndFormatted}</div>
                        </div>
                        <div class="renewal-info-item">
                            <div class="renewal-info-label">Account Manager</div>
                            <div class="renewal-info-value">${client.accountManager || 'Not assigned'}</div>
                        </div>
                        <div class="renewal-info-item">
                            <div class="renewal-info-label">Health Score</div>
                            <div class="renewal-info-value">
                                ${healthScore.toFixed(1)} 
                                <span class="status-badge ${healthCategory.color}" style="margin-left: 8px;">${healthCategory.label}</span>
                            </div>
                        </div>
                        <div class="renewal-info-item">
                            <div class="renewal-info-label">Client Since</div>
                            <div class="renewal-info-value">${joinDateFormatted}</div>
                        </div>
                        ${client.contractValue ? `
                        <div class="renewal-info-item">
                            <div class="renewal-info-label">Contract Value</div>
                            <div class="renewal-info-value">$${client.contractValue.toLocaleString()}</div>
                        </div>
                        ` : ''}
                    </div>

                    <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                        <button class="quick-action-btn confirmed" onclick="quickUpdateRenewalStatus('${client.id}', 'confirmed')">‚úÖ Confirm</button>
                        <button class="quick-action-btn discussion" onclick="quickUpdateRenewalStatus('${client.id}', 'discussion')">üí¨ Discussion</button>
                        <button class="quick-action-btn at-risk" onclick="quickUpdateRenewalStatus('${client.id}', 'at-risk')">‚ö†Ô∏è At Risk</button>
                        <button class="quick-action-btn churned" onclick="quickUpdateRenewalStatus('${client.id}', 'churned')">‚ùå Churned</button>
                    </div>

                    ${client.renewalNotes ? `
                    <div class="renewal-notes">${client.renewalNotes}</div>
                    ` : ''}

                    ${client.renewalTimeline && client.renewalTimeline.length > 0 ? `
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e5e7eb;">
                        <div style="font-size: 0.75rem; color: #6b7280; text-transform: uppercase; font-weight: 600; margin-bottom: 8px;">Renewal Timeline</div>
                        ${client.renewalTimeline.slice(-3).reverse().map(item => `
                            <div class="timeline-item">
                                <div class="timeline-date">${new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                                <div class="timeline-event">${item.event}${item.notes ? `: ${item.notes}` : ''}</div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                `;

                container.appendChild(card);
            });
        }

        function getRenewalStatusBadge(status) {
            const badges = {
                'confirmed': '<span class="renewal-badge confirmed">‚úÖ Confirmed</span>',
                'discussion': '<span class="renewal-badge discussion">üí¨ In Discussion</span>',
                'at-risk': '<span class="renewal-badge at-risk">‚ö†Ô∏è At Risk</span>',
                'churned': '<span class="renewal-badge churned">‚ùå Churned</span>',
                'pending': '<span class="renewal-badge pending">‚è≥ Pending</span>'
            };
            return badges[status] || badges['pending'];
        }

        function refreshRenewalPipeline() {
            updateRenewalPipeline();
        }

        function openOffboardModal(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            currentOffboardingClientId = clientId;
            document.getElementById('offboard-client-name').textContent = client.name;
            document.getElementById('offboard-modal').style.display = 'block';
        }

        function closeOffboardModal() {
            document.getElementById('offboard-modal').style.display = 'none';
            currentOffboardingClientId = null;
        }

        function confirmOffboard() {
            if (!currentOffboardingClientId) return;

            const offboardDate = document.getElementById('offboard-date').value;
            if (!offboardDate) {
                alert('Please select an offboard date');
                return;
            }

            const client = clients.find(c => c.id === currentOffboardingClientId);
            if (!client) return;

            const updatedClient = {
                ...client,
                isOffboarded: true,
                offboardDate: offboardDate,
                updatedAt: new Date().toISOString()
            };

            clientsRef.child(currentOffboardingClientId).set(updatedClient);

            closeOffboardModal();
            alert('Client offboarded successfully!');
        }

        function updateDashboard() {
            const stats = { 
                total: clients.length, 
                healthy: 0, 
                atRisk: 0, 
                critical: 0, 
                offboarded: 0 
            };
            
            clients.forEach(client => {
                if (client.isOffboarded) {
                    stats.offboarded++;
                } else {
                    const score = calculateHealthScore(client);
                    const category = getHealthCategory(score);
                    if (category.color === 'healthy') stats.healthy++;
                    else if (category.color === 'at-risk') stats.atRisk++;
                    else stats.critical++;
                }
            });

            document.getElementById('total-clients').textContent = stats.total;
            document.getElementById('healthy-clients').textContent = stats.healthy;
            document.getElementById('at-risk-clients').textContent = stats.atRisk;
            document.getElementById('critical-clients').textContent = stats.critical;
            document.getElementById('offboarded-clients').textContent = stats.offboarded;

            updateRenewalPipeline();
            updateTable();
        }

        function updateTable() {
            const tableBody = document.getElementById('client-table');
            const statusFilter = document.getElementById('client-status-filter').value;
            tableBody.innerHTML = '';

            let filteredClients = clients;
            
            if (statusFilter === 'active') {
                filteredClients = filteredClients.filter(c => !c.isOffboarded);
            } else if (statusFilter === 'offboarded') {
                filteredClients = filteredClients.filter(c => c.isOffboarded);
            }

            filteredClients.forEach(client => {
                const healthScore = calculateHealthScore(client);
                const category = getHealthCategory(healthScore, client.isOffboarded);
                
                const contractEndDate = client.contractEndDate ? new Date(client.contractEndDate).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                }) : 'Not set';

                const daysUntil = client.contractEndDate ? calculateDaysUntilRenewal(client.contractEndDate) : null;
                let renewalInfo = contractEndDate;
                if (daysUntil !== null && daysUntil >= 0) {
                    renewalInfo += ` (${daysUntil} days)`;
                } else if (daysUntil !== null && daysUntil < 0) {
                    renewalInfo += ` (EXPIRED)`;
                }

                const renewalStatusBadge = getRenewalStatusBadge(client.renewalStatus || 'pending');

                const row = document.createElement('tr');
                if (client.isOffboarded) {
                    row.className = 'offboarded';
                }
                
                row.innerHTML = `
                    <td>
                        <strong>${client.name}</strong>
                    </td>
                    <td>
                        <div class="account-manager">${client.accountManager || 'Not assigned'}</div>
                    </td>
                    <td>${renewalInfo}</td>
                    <td>${renewalStatusBadge}</td>
                    <td><strong>${client.isOffboarded ? 'N/A' : healthScore.toFixed(1)}</strong></td>
                    <td><span class="status-badge ${category.color}">${category.label}</span></td>
                    <td>
                        <div class="action-buttons">
                            ${!client.isOffboarded ? `
                                <button class="action-btn edit-btn" onclick="openRenewalModal('${client.id}')" title="Update Renewal">üìù</button>
                                <button class="action-btn edit-btn" onclick="editClient('${client.id}')" title="Edit Client">‚úèÔ∏è</button>
                                <button class="action-btn offboard-btn" onclick="openOffboardModal('${client.id}')" title="Offboard Client">üèÉ‚Äç‚ôÇÔ∏è</button>
                            ` : `
                                <button class="action-btn reactivate-btn" onclick="reactivateClient('${client.id}')" title="Reactivate Client">üîÑ</button>
                            `}
                            <button class="action-btn delete-btn" onclick="deleteClient('${client.id}')" title="Delete Client">üóëÔ∏è</button>
                        </div>
                    </td>`;
                
                tableBody.appendChild(row);
            });
        }

        function toggleForm() {
            const form = document.getElementById('client-form');
            form.classList.toggle('hidden');
            
            if (!form.classList.contains('hidden')) {
                resetForm();
            }
        }

        function resetForm() {
            currentEditingClientId = null;
            document.getElementById('form-title').textContent = 'Add New Client';
            document.getElementById('submit-btn').textContent = 'Add Client';
            document.getElementById('submit-btn').onclick = addClient;
            
            document.getElementById('name').value = '';
            document.getElementById('join-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('contract-end-date').value = '';
            document.getElementById('account-manager').value = '';
            document.getElementById('nps').value = '7';
            document.getElementById('showup').value = '85';
            document.getElementById('participation').value = '7';
            document.getElementById('payment-status').value = 'true';
            document.getElementById('video-viral').value = 'false';
            document.getElementById('early-signs').value = 'true';
            document.getElementById('form-renewal-status').value = 'pending';
            document.getElementById('contract-value').value = '';
            document.getElementById('notes').value = '';
            document.getElementById('form-renewal-notes').value = '';
        }

        function cancelForm() {
            const form = document.getElementById('client-form');
            form.classList.add('hidden');
            resetForm();
        }

        function editClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) {
                alert('Client not found');
                return;
            }

            currentEditingClientId = id;
            
            document.getElementById('form-title').textContent = 'Edit Client';
            document.getElementById('submit-btn').textContent = 'Update Client';
            document.getElementById('submit-btn').onclick = updateClient;
            
            document.getElementById('name').value = client.name;
            document.getElementById('join-date').value = client.joinDate || '';
            document.getElementById('contract-end-date').value = client.contractEndDate || '';
            document.getElementById('account-manager').value = client.accountManager || '';
            document.getElementById('nps').value = client.nps;
            document.getElementById('showup').value = client.sessionShowUp;
            document.getElementById('participation').value = client.participationLevel;
            document.getElementById('payment-status').value = (client.paymentOnTime !== undefined ? client.paymentOnTime : true).toString();
            document.getElementById('video-viral').value = (client.videoWentViral !== undefined ? client.videoWentViral : false).toString();
            document.getElementById('early-signs').value = (client.earlySigns !== undefined ? client.earlySigns : true).toString();
            document.getElementById('form-renewal-status').value = client.renewalStatus || 'pending';
            document.getElementById('contract-value').value = client.contractValue || '';
            document.getElementById('notes').value = client.notes || '';
            document.getElementById('form-renewal-notes').value = client.renewalNotes || '';
            
            document.getElementById('client-form').classList.remove('hidden');
        }

        function updateClient() {
            if (!currentEditingClientId) {
                alert('No client selected for editing');
                return;
            }

            const name = document.getElementById('name').value.trim();
            const joinDate = document.getElementById('join-date').value;
            const contractEndDate = document.getElementById('contract-end-date').value;
            const accountManager = document.getElementById('account-manager').value.trim();
            const nps = parseFloat(document.getElementById('nps').value) || 7;
            const sessionShowUp = parseInt(document.getElementById('showup').value) || 85;
            const participationLevel = parseFloat(document.getElementById('participation').value) || 7;
            const paymentOnTime = document.getElementById('payment-status').value === 'true';
            const videoWentViral = document.getElementById('video-viral').value === 'true';
            const earlySigns = document.getElementById('early-signs').value === 'true';
            const renewalStatus = document.getElementById('form-renewal-status').value;
            const contractValue = document.getElementById('contract-value').value;
            const notes = document.getElementById('notes').value.trim();
            const renewalNotes = document.getElementById('form-renewal-notes').value.trim();

            if (!name) {
                alert('Please enter a client name');
                return;
            }

            if (!joinDate) {
                alert('Please select a join date');
                return;
            }

            const existingClient = clients.find(c => c.id === currentEditingClientId);
            if (!existingClient) {
                alert('Client not found');
                return;
            }

            const updatedClient = {
                ...existingClient,
                name: name,
                joinDate: joinDate,
                contractEndDate: contractEndDate || null,
                accountManager: accountManager,
                nps: nps,
                sessionShowUp: sessionShowUp,
                participationLevel: participationLevel,
                paymentOnTime: paymentOnTime,
                videoWentViral: videoWentViral,
                earlySigns: earlySigns,
                renewalStatus: renewalStatus,
                contractValue: contractValue ? parseFloat(contractValue) : null,
                notes: notes,
                renewalNotes: renewalNotes,
                updatedAt: new Date().toISOString()
            };

            clientsRef.child(currentEditingClientId).set(updatedClient);

            cancelForm();
            alert('Client updated successfully!');
        }

        function addClient() {
            const name = document.getElementById('name').value.trim();
            const joinDate = document.getElementById('join-date').value;
            const contractEndDate = document.getElementById('contract-end-date').value;
            const accountManager = document.getElementById('account-manager').value.trim();
            const nps = parseFloat(document.getElementById('nps').value) || 7;
            const sessionShowUp = parseInt(document.getElementById('showup').value) || 85;
            const participationLevel = parseFloat(document.getElementById('participation').value) || 7;
            const paymentOnTime = document.getElementById('payment-status').value === 'true';
            const videoWentViral = document.getElementById('video-viral').value === 'true';
            const earlySigns = document.getElementById('early-signs').value === 'true';
            const renewalStatus = document.getElementById('form-renewal-status').value;
            const contractValue = document.getElementById('contract-value').value;
            const notes = document.getElementById('notes').value.trim();
            const renewalNotes = document.getElementById('form-renewal-notes').value.trim();

            if (!name) {
                alert('Please enter a client name');
                return;
            }

            if (!joinDate) {
                alert('Please select a join date');
                return;
            }

            const newClient = {
                id: Date.now().toString(),
                name: name,
                joinDate: joinDate,
                contractEndDate: contractEndDate || null,
                accountManager: accountManager,
                nps: nps,
                sessionShowUp: sessionShowUp,
                participationLevel: participationLevel,
                paymentOnTime: paymentOnTime,
                videoWentViral: videoWentViral,
                earlySigns: earlySigns,
                renewalStatus: renewalStatus,
                contractValue: contractValue ? parseFloat(contractValue) : null,
                notes: notes,
                renewalNotes: renewalNotes,
                isOffboarded: false,
                createdAt: new Date().toISOString()
            };

            clientsRef.child(newClient.id).set(newClient);

            resetForm();
            toggleForm();
        }

        function deleteClient(id) {
            const client = clients.find(c => c.id === id);
            const clientName = client ? client.name : 'this client';
            
            if (confirm(`Are you sure you want to permanently delete ${clientName}? This action cannot be undone.`)) {
                clientsRef.child(id).remove();
            }
        }

        function reactivateClient(clientId) {
            if (!confirm('Are you sure you want to reactivate this client?')) return;

            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            const updatedClient = {
                ...client,
                isOffboarded: false,
                reactivateDate: new Date().toISOString().split('T')[0],
                updatedAt: new Date().toISOString()
            };

            delete updatedClient.offboardDate;

            clientsRef.child(clientId).set(updatedClient);

            alert('Client reactivated successfully!');
        }

        function updateSyncIndicator(isConnected) {
            const dot = document.getElementById('sync-dot');
            const status = document.getElementById('sync-status');
            
            if (isConnected) {
                dot.classList.remove('offline');
                status.textContent = 'Connected';
            } else {
                dot.classList.add('offline');
                status.textContent = 'Offline';
            }
        }

        window.onclick = function(event) {
            const offboardModal = document.getElementById('offboard-modal');
            const renewalModal = document.getElementById('renewal-modal');
            if (event.target === offboardModal) {
                closeOffboardModal();
            }
            if (event.target === renewalModal) {
                closeRenewalModal();
            }
        }

        clientsRef.on('value', (snapshot) => {
            clients = [];
            snapshot.forEach((childSnapshot) => {
                clients.push(childSnapshot.val());
            });
            updateDashboard();
        });

        const connectedRef = database.ref('.info/connected');
        connectedRef.on('value', (snapshot) => {
            updateSyncIndicator(snapshot.val() === true);
        });
    </script>
</body>
</html>
